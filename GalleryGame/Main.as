package {	import flash.display.Sprite;	import flash.ui.Mouse;	import com.greensock.TweenNano;	import flash.events.MouseEvent;	import flash.events.Event;	import flash.utils.Timer;	import flash.events.TimerEvent;	public class Main extends Sprite	{		private var gridY:Array = new Array();		private var gridX:Array = new Array();		private var xPos:int = 0;		private var yPos:int = 0;		private var dartboards:Array = new Array();		private var smack:SmackSound = new SmackSound();		private var timer:Timer = new Timer(3000);		private var currentDartboards:int = 0;		private var levelComplete:int = 30;		private var scorePanel:ScorePanel = new ScorePanel();		public function Main():void		{			startCustomCursor();			namePanelHandler();			updateScore();			bg.addEventListener(MouseEvent.MOUSE_DOWN, addHits);		}		private function namePanelHandler():void		{			namePanel.beginButton.stop();			namePanel.beginButton.addEventListener(MouseEvent.MOUSE_UP, setPlayerName);			TweenNano.from(namePanel, 0.5, {y: -namePanel.height/2});		}		private function setPlayerName(e:MouseEvent):void		{			smack.play();			namePanel.beginButton.gotoAndPlay(3);			playerName.text = namePanel.nameField.text;			TweenNano.to(namePanel, 0.5, {y: stage.stageHeight + namePanel.height/2, onComplete: beginGame});		}		private function startCustomCursor():void		{			Mouse.hide();			cursor.startDrag(true);		}		private function calculateGrid():void		{			gridX = [];			gridY = [];			for (var h:int = 1; h <= (stage.stageHeight - 160) / 80; h++)			{				gridY.push(80 * h);			}			for (var v:int = 1; v <= (stage.stageWidth - 160) / 80; v++)			{				gridX.push(80 * v);			}		}		private function addRandomDartboards(amount:int):void		{			calculateGrid();			for (var i:int = 0; i < amount; i++)			{								var dartboard:Dartboard = new Dartboard();				dartboard.stop();				xPos = gridX[Math.floor(Math.random() * gridX.length)];				yPos = gridY[Math.floor(Math.random() * gridY.length)];				dartboard.x = xPos + 40;				dartboard.y = yPos + 40;				gridX.splice(gridX.indexOf(xPos), 1);				gridY.splice(gridY.indexOf(yPos), 1);				dartboard.addEventListener(MouseEvent.MOUSE_DOWN, destroyDartboard);				addChild(dartboard);				TweenNano.from(dartboard, 0.6, {rotationY: 180});				TweenNano.from(dartboard, 0.6, {scaleX: 0.4});				TweenNano.from(dartboard, 0.6, {scaleY: 0.4});				dartboards.push(dartboard);				setChildIndex(cursor, (numChildren - 1));				currentDartboards++;			}		}		private function destroyDartboard(e:MouseEvent):void		{			smack.play();			e.target.removeEventListener(MouseEvent.MOUSE_DOWN, destroyDartboard);			e.target.gotoAndPlay(3);			e.target.addEventListener(Event.ENTER_FRAME, removeDartboard);			dartboards.splice(dartboards.indexOf(e.target), 1);			if (dartboards.length == 0)			{				timer.stop();				addRandomDartboards(5);				timer.start();			}			updateScore(1);			updateHits(1);			var plusOne:ScorePlus = new ScorePlus();			plusOne.x = e.target.x;			plusOne.y = e.target.y + plusOne.height;			addChild(plusOne);			TweenNano.from(plusOne, 0.5, {scaleX: 0.5});			TweenNano.from(plusOne, 0.5, {scaleY: 0.5, onComplete:removeScoreGFX, onCompleteParams: [plusOne]});		}		private function removeScoreGFX(target:Sprite):void		{			removeChild(target);		}		private function removeDartboard(e:Event):void		{			if (e.target.currentFrame == 8)			{				e.target.removeEventListener(Event.ENTER_FRAME, removeDartboard);				removeChild(e.target as Sprite);			}		}		private function updateScore(addToScore:int = 0):void		{			score.text = String(int(score.text) + addToScore);		}		private function updateHits(addToHits:int = 0):void		{			hits.text = String(int(hits.text) + addToHits);			TweenNano.from(hits, 0.3, {y: -5});		}		private function addHits(e:MouseEvent):void		{			score.text = String(int(score.text) + int(hits.text));			hits.text = "0";		}		private function beginGame(restarting:Boolean = false):void		{			if (! restarting)			{				removeChild(namePanel);			}			addRandomDartboards(5);			timer.addEventListener(TimerEvent.TIMER, removeRemainingListeners);			timer.start();		}		private function removeRemainingListeners(e:TimerEvent):void		{			timer.stop();			if (currentDartboards < levelComplete)			{				for (var i:int = 0; i < dartboards.length; i++)				{					dartboards[i].removeEventListener(MouseEvent.MOUSE_DOWN, destroyDartboard);				}			}			removeRemaining();		}		private function removeRemaining():void		{			for (var i:int = dartboards.length-1; i >= 0; i--)			{				removeChild(dartboards[i]);				dartboards.length = i;				if (dartboards.length == 0 && currentDartboards < levelComplete)				{					addRandomDartboards(5);					timer.start();				}				else if (dartboards.length == 0 && currentDartboards >= levelComplete)				{					levelCompleted();				}			}		}		private function levelCompleted():void		{			score.text = String(int(score.text) + int(hits.text));			hits.text = "0";			score.visible = false;			playerName.visible = false;			TweenNano.to(infoBg, 0.5, {x: -infoBg.width/2});			scorePanel.x = stage.stageWidth + scorePanel.width / 2;			scorePanel.y = stage.stageHeight / 2;			scorePanel.myScore.text = score.text;			scorePanel.playAgain.addEventListener(MouseEvent.MOUSE_UP, restart);			addChild(scorePanel);			setChildIndex(cursor, (numChildren - 1));			TweenNano.to(scorePanel, 0.5, {x: stage.stageWidth/2});		}		private function restart(e:MouseEvent):void		{			score.visible = true;			score.text = "0";			playerName.visible = true;			scorePanel.playAgain.removeEventListener(MouseEvent.MOUSE_UP, restart);			TweenNano.to(infoBg, 0.5, {x: infoBg.width/2});			TweenNano.to(scorePanel, 0.5, {x: stage.stageWidth + scorePanel.width/2, onComplete: removeScorePanel});			currentDartboards = 0;			beginGame(true);		}		private function removeScorePanel():void		{			removeChild(scorePanel);		}	}}